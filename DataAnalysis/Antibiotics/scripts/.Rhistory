plantP = plant.counts/Total.samples,
soilP = soil.counts/Total.samples)
Dt
Denv <- Dt %>% mutate(aquaP = aquatic.counts/Total.samples ,
animalP = animal.counts/Total.samples,
plantP = plant.counts/Total.samples,
soilP = soil.counts/Total.samples)
fitTaxPhylum <- lm(Tdiv ~ 0 + Tn16 + Tn16:phylum ,Dt)
res <- Dt %>%
add_residuals(fitTaxPhylum)
Dt %<>%
group_by(phylum) %>%
mutate(n = n()) %>%
ungroup() %>%
filter(n > 20)
Dt %<>%
group_by(phylum) %>%
mutate(n = n()) %>%
ungroup() %>%
filter(n > 20)
# Lets add it to the model
Dt
fitTaxPhylum <- lm(Tdiv ~ 0 + Tn16 + Tn16:phylum ,Dt)
summary(fitTaxPhylum)
res <- Dt %>%
add_residuals(fitTaxPhylum)
res %>%
ggplot(aes(resid)) + geom_histogram(bins = 40,binwidth = 0.1)
res %>%
ggplot(aes(x=exp(Tn16) ,y=resid)) +
geom_hex(bins=50) +
geom_ref_line(h=0, col = "red", size = 1) +
geom_smooth()
par(mfrow=c(2,2))
plot(fitTaxPhylum )
# We have on with a very large amount of n16
Dsub %>% filter(n16>20)
#I checked and its also high here
#https://www.arb-silva.de/search/
#Tumebacillus avium
Dt %<>%
group_by(phylum) %>%
mutate(n = n()) %>%
ungroup() %>%
filter(n > 20)
# Lets add it to the model
Dt
fitTaxPhylum <- lm(Tdiv ~ 0 + Tn16 + Tn16:phylum ,Dt)
summary(fitTaxPhylum)
res <- Dt %>%
add_residuals(fitTaxPhylum)
res %>%
ggplot(aes(resid)) + geom_histogram(bins = 40,binwidth = 0.1)
res %>%
ggplot(aes(x=exp(Tn16) ,y=resid)) +
geom_hex(bins=50) +
geom_ref_line(h=0, col = "red", size = 1) +
geom_smooth()
par(mfrow=c(2,2))
plot(fitTaxPhylum )
# We have on with a very large amount of n16
Dsub %>% filter(n16>20)
#I checked and its also high here
#https://www.arb-silva.de/search/
#Tumebacillus avium
Dt %<>%
group_by(phylum) %>%
mutate(n = n()) %>%
ungroup() %>%
filter(n > 100)
# Lets add it to the model
Dt
fitTaxPhylum <- lm(Tdiv ~ 0 + Tn16 + Tn16:phylum ,Dt)
summary(fitTaxPhylum)
res <- Dt %>%
add_residuals(fitTaxPhylum)
res %>%
ggplot(aes(resid)) + geom_histogram(bins = 40,binwidth = 0.1)
res %>%
ggplot(aes(x=exp(Tn16) ,y=resid)) +
geom_hex(bins=50) +
geom_ref_line(h=0, col = "red", size = 1) +
geom_smooth()
par(mfrow=c(2,2))
plot(fitTaxPhylum )
# We have on with a very large amount of n16
Dsub %>% filter(n16>20)
#I checked and its also high here
#https://www.arb-silva.de/search/
#Tumebacillus avium
Dt <- Dt %>%
group_by(phylum) %>%
mutate(n = n()) %>%
ungroup() %>%
filter(n > 100)
# Lets add it to the model
Dt
fitTaxPhylum <- lm(Tdiv ~ 0 + Tn16 + Tn16:phylum ,Dt)
summary(fitTaxPhylum)
res <- Dt %>%
add_residuals(fitTaxPhylum)
res %>%
ggplot(aes(resid)) + geom_histogram(bins = 40,binwidth = 0.1)
res %>%
ggplot(aes(x=exp(Tn16) ,y=resid)) +
geom_hex(bins=50) +
geom_ref_line(h=0, col = "red", size = 1) +
geom_smooth()
par(mfrow=c(2,2))
plot(fitTaxPhylum )
# We have on with a very large amount of n16
Dsub %>% filter(n16>20)
#I checked and its also high here
#https://www.arb-silva.de/search/
#Tumebacillus avium
summary(fitTaxPhylum)
Dt <- Dt %>%
group_by(phylum) %>%
mutate(n = n()) %>%
ungroup() %>%
filter(n > 500)
# Lets add it to the model
Dt
# Lets add it to the model
Dt
fitTaxPhylum <- lm(Tdiv ~ 0 + Tn16 + Tn16:phylum ,Dt)
summary(fitTaxPhylum)
Dt <- Dt %>%
group_by(phylum) %>%
mutate(n = n()) %>%
ungroup() %>%
filter(n > 20)
# Lets add it to the model
Dt
# Lets add it to the model
Dt
fitTaxPhylum <- lm(Tdiv ~ 0 + Tn16 + Tn16:phylum ,Dt)
summary(fitTaxPhylum)
res <- Dt %>%
add_residuals(fitTaxPhylum)
res <- Dt %>%
add_residuals(fitTaxPhylum)
res %>%
ggplot(aes(resid)) + geom_histogram(bins = 40,binwidth = 0.1)
res %>%
ggplot(aes(x=exp(Tn16) ,y=resid)) +
geom_hex(bins=50) +
geom_ref_line(h=0, col = "red", size = 1) +
geom_smooth()
par(mfrow=c(2,2))
Denv <- Dt %>% mutate(aquaP = aquatic.counts/Total.samples ,
animalP = animal.counts/Total.samples,
plantP = plant.counts/Total.samples,
soilP = soil.counts/Total.samples)
fitTaxPhylum <- lm(Tdiv ~ 0 + Tn16 + Tn16:phylum ,Dt)
res <- Dt %>%
add_residuals(fitTaxPhylum)
fitTaxPhylum <- lm(Tdiv ~ Tn16 + Tn16:phylum ,Dt)
res <- Dt %>%
add_residuals(fitTaxPhylum)
fitTaxPhylum <- lm(Tdiv ~ Tn16 + Tn16:phylum ,Dt)
res <- Dt %>%
add_residuals(fitTaxPhylum)
fitTaxPhylum <- lm(Tdiv ~ Tn16 + Tn16:phylum ,Dt)
res <- Dt %>%
add_residuals(fitTaxPhylum)
fitTaxPhylum <- lm(Tdiv ~ Tn16 + Tn16:phylum -1 ,Dt)
res <- Dt %>%
add_residuals(fitTaxPhylum)
fitTaxPhylum <- glm(Tdiv ~ Tn16 + Tn16:phylum -1 ,Dt)
res <- Dt %>%
add_residuals(fitTaxPhylum)
fitTaxPhylum <- glm(Tdiv ~ Tn16 + Tn16:phylum -1 ,Dt)
res <- Dt %>%
add_residuals(fitTaxPhylum)
Denv <- Dt %>% mutate(aquaP = aquatic.counts/Total.samples ,
animalP = animal.counts/Total.samples,
plantP = plant.counts/Total.samples,
soilP = soil.counts/Total.samples)
fitTaxPhylum <- glm(Tdiv ~ Tn16 + Tn16:phylum -1 ,Denv)
res <- Dt %>%
add_residuals(fitTaxPhylum)
Dt
Dt <- D %>%
mutate(Tn16=log(n16), Tdiv=log1p(div))
Denv <- Dt %>% mutate(aquaP = aquatic.counts/Total.samples ,
animalP = animal.counts/Total.samples,
plantP = plant.counts/Total.samples,
soilP = soil.counts/Total.samples)
fitTaxPhylum <- glm(Tdiv ~ Tn16 + Tn16:phylum -1 ,Denv)
fitTaxPhylum <- lm(Tdiv ~ Tn16 + Tn16:phylum -1 ,Denv)
res <- Dt %>%
add_residuals(fitTaxPhylum)
res <- Dt %>%
add_residuals(fitTaxPhylum)
summary(fitTaxPhylum)
Dt <- D %>%
mutate(Tn16=log(n16), Tdiv=log1p(div))
Dt <- Dt %>%
group_by(phylum) %>%
mutate(n = n()) %>%
ungroup() %>%
filter(n > 20)
Denv <- Dt %>% mutate(aquaP = aquatic.counts/Total.samples ,
animalP = animal.counts/Total.samples,
plantP = plant.counts/Total.samples,
soilP = soil.counts/Total.samples)
fitTaxPhylum <- lm(Tdiv ~ Tn16 + Tn16:phylum -1 ,Denv)
res <- Dt %>%
add_residuals(fitTaxPhylum)
summary(fitTaxPhylum)
fitTaxPhylum <- lm(Tdiv ~ Tn16 + Tn16:phylum ,Denv)
res <- Dt %>%
add_residuals(fitTaxPhylum)
summary(fitTaxPhylum)
fitTaxPhylum <- lm(Tdiv ~ Tn16 + Tn16:phylum -1 ,Denv)
res <- Dt %>%
add_residuals(fitTaxPhylum)
summary(fitTaxPhylum)
ggplot(D, aes(x=aquatic.counts, y=resid)) +
geom_point()
ggplot(D, aes(x=aquaP, y=resid)) +
geom_point()
Dt <- D %>%
mutate(Tn16=log(n16), Tdiv=log1p(div))
Dt <- Dt %>%
group_by(phylum) %>%
mutate(n = n()) %>%
ungroup() %>%
filter(n > 20)
Denv <- Dt %>% mutate(aquaP = aquatic.counts/Total.samples ,
animalP = animal.counts/Total.samples,
plantP = plant.counts/Total.samples,
soilP = soil.counts/Total.samples)
fitTaxPhylum <- lm(Tdiv ~ Tn16 + Tn16:phylum -1 ,Denv)
res <- Denv %>%
add_residuals(fitTaxPhylum)
summary(fitTaxPhylum)
ggplot(Denv, aes(x=aquaP, y=resid)) +
geom_point()
ggplot(res, aes(x=aquaP, y=resid)) +
geom_point()
ggplot(res, aes(x=animalP, y=resid)) +
geom_point()
ggplot(res, aes(x=plantP, y=resid)) +
geom_point()
ggplot(res, aes(x=soilP, y=resid)) +
geom_point()
Dt <- D %>%
mutate(Tn16=log(n16), Tdiv=log1p(div))
Dt <- Dt %>%
group_by(phylum) %>%
mutate(n = n()) %>%
ungroup() %>%
filter(n > 20)
Denv <- Dt %>% mutate(aquaP = aquatic.counts/Total.samples ,
animalP = animal.counts/Total.samples,
plantP = plant.counts/Total.samples,
soilP = soil.counts/Total.samples)
fitTaxPhylum <- lm(Tdiv ~ Tn16 + Tn16:phylum -1 ,Denv)
res <- Denv %>%
add_residuals(fitTaxPhylum)
summary(fitTaxPhylum)
p1 <- ggplot(res, aes(x=aquaP, y=resid)) +
geom_point()
p2 <- ggplot(res, aes(x=plantP, y=resid)) +
geom_point()
p3 <- ggplot(res, aes(x=animalP, y=resid)) +
geom_point()
p4 <- ggplot(res, aes(x=soilP, y=resid)) +
geom_point()
plot_grid(p1, p2, p3, p4,labels ="auto")
Dt <- D %>%
mutate(Tn16=log(n16), Tdiv=log1p(div))
colnames(Dt)
Dt
Dt$antibiotics
mutate(Dt, antibiotics = ifelse(is.na(antibiotics)), "PNR", antibiotics)
mutate(Dt, antibiotics = ifelse(is.na(antibiotics), "PNR", antibiotics))
Dt <- mutate(Dt, antibiotics = ifelse(is.na(antibiotics), "PNR", antibiotics))
fitTaxPhylum <- lm(Tdiv ~ Tn16 + Tn16:phylum -1 ,Denv)
fitTaxPhylum <- lm(Tdiv ~ Tn16 + Tn16:phylum -1 ,Dt)
res <- Dt %>%
add_residuals(fitTaxPhylum)
summary(fitTaxPhylum)
ggplot(res, aes(x=gram.stain, y=resid)) +
geom_hist()
ggplot(res, aes(x=gram.stain, y=resid)) +
geom_boxplot()
Dt <- D %>%
mutate(Tn16=log(n16), Tdiv=log1p(div))
Dt <- Dt %>%
group_by(phylum) %>%
mutate(n = n()) %>%
ungroup() %>%
filter(n > 20)
Dt <- mutate(Dt, antibiotics = ifelse(is.na(antibiotics), "PNR", antibiotics))
fitTaxPhylum <- lm(Tdiv ~ Tn16 + Tn16:phylum -1 ,Dt)
res <- Dt %>%
add_residuals(fitTaxPhylum)
summary(fitTaxPhylum)
p1 <- ggplot(res, aes(x=gram.stain, y=resid)) +
geom_boxplot()
p2 <- ggplot(res, aes(x=PH.range, y=resid)) +
geom_boxplot()
p3 <- ggplot(res, aes(x=motility, y=resid)) +
geom_boxplot()
p4 <- ggplot(res, aes(x=antibiotics, y=resid)) +
geom_point()
plot_grid(p1, p2, p3, p4,labels ="auto")
Dt <- D %>%
mutate(Tn16=log(n16), Tdiv=log1p(div))
Dt <- Dt %>%
group_by(phylum) %>%
mutate(n = n()) %>%
ungroup() %>%
filter(n > 20)
Dt <- mutate(Dt, antibiotics = ifelse(is.na(antibiotics), "PNR", antibiotics))
fitTaxPhylum <- lm(Tdiv ~ Tn16 + Tn16:phylum -1 ,Dt)
res <- Dt %>%
add_residuals(fitTaxPhylum)
summary(fitTaxPhylum)
p1 <- ggplot(res, aes(x=gram.stain, y=resid)) +
geom_boxplot()
p2 <- ggplot(res, aes(x=PH.range, y=resid)) +
geom_boxplot()
p3 <- ggplot(res, aes(x=motility, y=resid)) +
geom_boxplot()
p4 <- ggplot(res, aes(x=antibiotics, y=resid)) +
geom_boxplot()
plot_grid(p1, p2, p3, p4,labels ="auto")
Dt <- D %>%
mutate(Tn16=log(n16), Tdiv=log1p(div))
Dt <- Dt %>%
group_by(phylum) %>%
mutate(n = n()) %>%
ungroup() %>%
filter(n > 20)
Dt <- mutate(Dt, antibiotics = ifelse(is.na(antibiotics), "PNR", antibiotics))
fitTaxPhylum <- lm(Tdiv ~ Tn16 + Tn16:phylum -1 ,Dt)
res <- Dt %>%
add_residuals(fitTaxPhylum)
summary(fitTaxPhylum)
p1 <- ggplot(res, aes(x=gram.stain, y=resid)) +
geom_violin()
p2 <- ggplot(res, aes(x=PH.range, y=resid)) +
geom_boxplot()
p3 <- ggplot(res, aes(x=motility, y=resid)) +
geom_boxplot()
p4 <- ggplot(res, aes(x=antibiotics, y=resid)) +
geom_boxplot()
plot_grid(p1, p2, p3, p4,labels ="auto")
p1 <- ggplot(res, aes(x=gram.stain, y=resid)) +
geom_violin() +
geom_point()
plot_grid(p1, p2, p3, p4,labels ="auto")
p1 <- ggplot(res, aes(x=gram.stain, y=resid)) +
geom_violin() +
geom_point(size=0.1)
plot_grid(p1, p2, p3, p4,labels ="auto")
Dt <- D %>%
mutate(Tn16=log(n16), Tdiv=log1p(div))
Dt <- Dt %>%
group_by(phylum) %>%
mutate(n = n()) %>%
ungroup() %>%
filter(n > 20)
Dt <- mutate(Dt, antibiotics = ifelse(is.na(antibiotics), "PNR", antibiotics))
fitTaxPhylum <- lm(Tdiv ~ Tn16 + Tn16:phylum -1 ,Dt)
res <- Dt %>%
add_residuals(fitTaxPhylum)
summary(fitTaxPhylum)
p1 <- ggplot(res, aes(x=gram.stain, y=resid)) +
geom_violin() +
geom_point(size=1)
p2 <- ggplot(res, aes(x=PH.range, y=resid)) +
geom_violin() +
geom_point(size=1)
p3 <- ggplot(res, aes(x=motility, y=resid)) +
geom_violin() +
geom_point(size=1)
p4 <- ggplot(res, aes(x=antibiotics, y=resid)) +
geom_violin() +
geom_point(size=1)
plot_grid(p1, p2, p3, p4,labels ="auto")
Dt <- D %>%
mutate(Tn16=log(n16), Tdiv=log1p(div))
Dt <- Dt %>%
group_by(phylum) %>%
mutate(n = n()) %>%
ungroup() %>%
filter(n > 20)
Dt <- mutate(Dt, antibiotics = ifelse(is.na(antibiotics), "PNR", antibiotics))
fitTaxPhylum <- lm(Tdiv ~ Tn16 + Tn16:phylum -1 ,Dt)
res <- Dt %>%
add_residuals(fitTaxPhylum)
summary(fitTaxPhylum)
p1 <- ggplot(res, aes(x=gram.stain, y=resid)) +
geom_violin() +
geom_point(size=0.2)
p2 <- ggplot(res, aes(x=PH.range, y=resid)) +
geom_violin() +
geom_point(size=0.2)
p3 <- ggplot(res, aes(x=motility, y=resid)) +
geom_violin() +
geom_point(size=0.2)
p4 <- ggplot(res, aes(x=antibiotics, y=resid)) +
geom_violin() +
geom_point(size=0.2)
plot_grid(p1, p2, p3, p4,labels ="auto")
Dt <- D %>%
mutate(Tn16=log(n16), Tdiv=log1p(div))
Dt <- Dt %>%
group_by(phylum) %>%
mutate(n = n()) %>%
ungroup() %>%
filter(n > 20)
Dt <- mutate(Dt, antibiotics = ifelse(is.na(antibiotics), "PNR", antibiotics))
fitTaxPhylum <- lm(Tdiv ~ Tn16 + Tn16:phylum -1 ,Dt)
res <- Dt %>%
add_residuals(fitTaxPhylum)
summary(fitTaxPhylum)
p1 <- ggplot(res, aes(x=gram.stain, y=resid)) +
geom_violin() +
geom_booxplot(alpha=0.5)
Dt <- D %>%
mutate(Tn16=log(n16), Tdiv=log1p(div))
Dt <- Dt %>%
group_by(phylum) %>%
mutate(n = n()) %>%
ungroup() %>%
filter(n > 20)
Dt <- mutate(Dt, antibiotics = ifelse(is.na(antibiotics), "PNR", antibiotics))
fitTaxPhylum <- lm(Tdiv ~ Tn16 + Tn16:phylum -1 ,Dt)
res <- Dt %>%
add_residuals(fitTaxPhylum)
summary(fitTaxPhylum)
p1 <- ggplot(res, aes(x=gram.stain, y=resid)) +
geom_violin() +
geom_boxplot(alpha=0.5)
p2 <- ggplot(res, aes(x=PH.range, y=resid)) +
geom_violin() +
geom_point(size=0.2)
p3 <- ggplot(res, aes(x=motility, y=resid)) +
geom_violin() +
geom_point(size=0.2)
p4 <- ggplot(res, aes(x=antibiotics, y=resid)) +
geom_violin() +
geom_point(size=0.2)
plot_grid(p1, p2, p3, p4,labels ="auto")
Dt <- D %>%
mutate(Tn16=log(n16), Tdiv=log1p(div))
Dt <- Dt %>%
group_by(phylum) %>%
mutate(n = n()) %>%
ungroup() %>%
filter(n > 20)
Dt <- mutate(Dt, antibiotics = ifelse(is.na(antibiotics), "PNR", antibiotics))
fitTaxPhylum <- lm(Tdiv ~ Tn16 + Tn16:phylum -1 ,Dt)
res <- Dt %>%
add_residuals(fitTaxPhylum)
summary(fitTaxPhylum)
p1 <- ggplot(res, aes(x=gram.stain, y=resid)) +
geom_violin(draw_quantiles = c(0.25, 0.5, 0.75))
p2 <- ggplot(res, aes(x=PH.range, y=resid)) +
geom_violin(draw_quantiles = c(0.25, 0.5, 0.75)) +
geom_point(size=0.2)
p3 <- ggplot(res, aes(x=motility, y=resid)) +
geom_violin(draw_quantiles = c(0.25, 0.5, 0.75)) +
geom_point(size=0.2)
p4 <- ggplot(res, aes(x=antibiotics, y=resid)) +
geom_violin(draw_quantiles = c(0.25, 0.5, 0.75)) +
geom_point(size=0.2)
plot_grid(p1, p2, p3, p4,labels ="auto")
knitr::opts_chunk$set(echo = TRUE)
library(RSQLite)
library(tidyverse)
library(caret)
library(magrittr)
library(glue)
library(cowplot)
library(modelr)
# Connect to the DB
conn <- dbConnect(SQLite(),"../../../s16.sqlite")
# List of all the tables
dbListTables(conn)
D_tmp <- dbGetQuery(conn, "SELECT * FROM ribdif_bacdive_joined")
D_tmp <- tibble(D_tmp, .name_repair ="universal")
D_tmp <- mutate(D_tmp, across(antibiotics:PH.range, factor))
D_tmp <- select(D_tmp, !c(NCBI.tax.ID,strain.designation))
ggplot(res, aes(x=ggplot(res, aes(x=antibiotics, y=resid)) +
geom_violin(draw_quantiles = c(0.25, 0.5, 0.75)) +
geom_point(size=0.2), y=resid)) +
geom_violin(draw_quantiles = c(0.25, 0.5, 0.75)) +
geom_point(size=0.2)
ggplot(res, aes(x=tobramycin, y=resid)) +
geom_violin(draw_quantiles = c(0.25, 0.5, 0.75)) +
geom_point(size=0.2)
ggplot(res, aes(x=tobramycin, y=resid)) +
geom_boxplot(draw_quantiles = c(0.25, 0.5, 0.75)) +
geom_point(size=0.2)
D
colnames(Dt)
ggplot(res, aes(x=tunicamycin, y=resid)) +
geom_boxplot(draw_quantiles = c(0.25, 0.5, 0.75)) +
geom_point(size=0.2)
ggplot(res, aes(x=cephalexin, y=resid)) +
geom_boxplot(draw_quantiles = c(0.25, 0.5, 0.75)) +
geom_point(size=0.2)
ggplot(res, aes(x=cefoxitin, y=resid)) +
geom_boxplot(draw_quantiles = c(0.25, 0.5, 0.75)) +
geom_point(size=0.2)
